bool[] out_state
bool[] in_state